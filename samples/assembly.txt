
INSERT_LOOP:
 ADD DI,CX
 MOV CX,[DI]
 MOV WORD PTR [DI],0A0DH
 CMP CX,0
 JNZ INSERT_LOOP

WRITE_FILE:
 MOV DX,BUFFER+2
 MOV CX,BP
 SUB CX,DX
 MOV BX,1
 sys WRITE
 JC  BADWRT
 CMP AX,CX
 JZ  WRTOK

BADWRT:
 MOV SI,OFFSET dg:ERRMSG2
 JMP ERROR_EXIT

WRTOK:
 XOR AL,AL
 sys EXIT